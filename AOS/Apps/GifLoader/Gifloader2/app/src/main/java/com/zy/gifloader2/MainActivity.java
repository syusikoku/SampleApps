package com.zy.gifloader2;import android.graphics.Bitmap;import android.os.Environment;import android.os.Message;import com.zy.gifloader2.databinding.ActivityMainBinding;import com.zy.gifloader2.databinding.ActivityMainBindingImpl;import java.io.File;import cn.charles.kasa.framework.base.BaseDataBindingActivity;import cn.charles.kasa.framework.utils.LogUtil;public class MainActivity extends BaseDataBindingActivity<ActivityMainBinding> {    private final String ERROR = "目标文件不存在，请确认";    public GifLoader mGifLoader;    private Bitmap mBitmap;    private File mGifPath;    @Override    protected int getLayoutResId() {        return R.layout.activity_main;    }    @Override    protected void initDataBinding() {        MainEvent tmpMainEvent = new MainEvent(this);        mBinding.setMainEvent(tmpMainEvent);    }    @Override    protected void initData() {        mGifLoader = new GifLoader();        // LogUtil.loge("test jni: " + sum(10, 15));        mGifPath = new File(Environment.getExternalStorageDirectory(), "test1.gif");        if (mGifPath == null || !mGifPath.exists()) {            showShortToast(ERROR);            return;        }    }    private void doLoadGif() {        if (mGifPath == null || !mGifPath.exists()) {            showShortToast(ERROR);            return;        }        mGifLoader.load(mGifPath.getAbsolutePath());        int tmpWidth = mGifLoader.getWidth();        int tmpHeight = mGifLoader.getHeight();        // LogUtil.loge("tw = " + tmpWidth + " , th = " + tmpHeight);        mBitmap = Bitmap.createBitmap(tmpWidth, tmpHeight, Bitmap.Config.ARGB_8888);        long gifDealy = mGifLoader.updateFrame(mBitmap);        mWeakHandler.sendEmptyMessageDelayed(0, gifDealy);    }    @Override    protected void processMsg(Message msg) {        // LogUtil.loge("处理消息");        long gifDealy = mGifLoader.updateFrame(mBitmap);        // LogUtil.loge("显示图片");        mBinding.sampleIv.setImageBitmap(mBitmap);        // LogUtil.loge("发送消息");        mWeakHandler.sendEmptyMessageDelayed(0, gifDealy);    }    public static class MainEvent {        private final MainActivity mAct;        public MainEvent(MainActivity _mainActivity) {            this.mAct = _mainActivity;        }        public void doLoadPic() {            // LogUtil.loge("加载图片");            if (mAct != null) {                mAct.doLoadGif();            }        }    }    public native int sum(int a, int b);}